<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
</head>
<body class="bg-zinc-950">
    <header class="w-full fixed bottom-0 left-0 bg-zinc-900/80 backdrop-blur-md rounded-t-lg z-150">
        <div class="px-4 py-6">
            <div class="grid grid-cols-3" id="hd-sections"></div>
        </div>
    </header>

    <main class="min-h-screen p-4 backdrop-blur-3xl">
        <section class="h-full hidden" id="profile">
            <div class="flex flex-col gap-4 pb-20">
                <!-- Панель профиля -->
                <div class="grid grid-cols-[64px_auto] gap-4 items-center p-4 border border-gray-300/10 backdrop-blur-xl rounded-xl">
                    <img id="user-photo" src="" alt="avatar" class="w-16 h-16 rounded-full border border-zinc-700">
                    <div class="flex flex-col">
                        <h3 id="user-name" class="text-white font-bold text-xl"></h3>
                        <p id="user-username" class="text-gray-400 text-sm"></p>
                    </div>
                </div>

                <!-- Дополнительные блоки -->
                <div class="flex flex-col items-center p-4 gap-4 border border-gray-300/10 backdrop-blur-xl rounded-xl">
                    <h4 class="text-white font-semibold text-xl">Заказы:</h4>
                    <div class="grid grid-cols-2 gap-4 mt-2" id="orders"></div>
                </div>
            </div>
        </section>
        <section class="h-full hidden" id="products">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 pb-20" id="productscont"></div>
        </section>
        <section class="h-full hidden" id="support">
            <div class="text-white">Пока пусто...</div>
        </section>
    </main>

    <div class="fixed top-[50%] left-[50%] -translate-[50%] z-[-50] w-[80%] h-[40%] rounded-full bg-blue-600/70"></div>

    <script src="./js/products.js"></script>
    <script src="./js/orders.js"></script>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const user = tg.initDataUnsafe?.user;

        if (user) {
            document.getElementById('user-photo').src = user.photo_url || "https://via.placeholder.com/64";
            document.getElementById('user-name').textContent = `${user.first_name || ""} ${user.last_name || ""}`;
            document.getElementById('user-username').textContent = user.username ? "@" + user.username : "Без username";

            const sendUserData = async () => {
                try {
                    const payload = {
                        id: user.id,
                        first_name: user.first_name,
                        last_name: user.last_name || ''
                    };

                    // const res = await fetch('https://holpenstudioback-production.up.railway.app/api/addUser'
                    const response = await fetch('https://holpenstudioback-production.up.railway.app/api/addUser', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    const data = await response.json();

                    if (data.success) {
                        console.log('Пользователь добавлен, ID в БД:', data.userId);
                    } else {
                        console.warn('Ошибка при добавлении пользователя:', data.message);
                    }
                } catch (error) {
                    console.error('Ошибка при отправке данных:', error);
                }
            };

            sendUserData();

        } else {
            console.warn('Пользователь не найден в initDataUnsafe');
        }
    </script>

    <script>
        const hdsections = document.getElementById('hd-sections');

        const sections = [
            { name: 'Профиль', icon: 'fa-user', data: 'profile' },
            { name: 'Товары', icon: 'fa-cart-shopping', data: 'products' },
            { name: 'Поддержка', icon: 'fa-message', data: 'support' }
        ];

        const sectionlist = sections.map(section => `<div class="flex flex-col justify-center items-center gap-1 hd-btns transition-color duration-300" data-target="${section.data}">
            <i class="fa-solid ${section.icon} text-lg"></i>
            <h4 class="text-sm font-normal tracking-tight">${section.name}</h4>
        </div>`).join('');

        hdsections.innerHTML = sectionlist;
    </script>

    <script src="./js/changesection.js"></script>
</body>
</html>
